<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Observer Dashboard - Democracy Watch & Observers</title>
  <link rel="stylesheet" href="index.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
  <style>
    .observer-header { background: linear-gradient(135deg, #116530 0%, #19A463 100%); color: white; padding: 1rem 0; margin-bottom: 1.5rem; }
    .observer-card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); padding: 1rem; margin-bottom: 1rem; }
    .heat-legend span { display: inline-block; width: 14px; height: 14px; border-radius: 3px; margin-right: 6px; }
    .flag-red { background: #dc3545; color: white; padding: 0.2rem 0.5rem; border-radius: 8px; font-size: 0.75rem; }
    .flag-amber { background: #ffc107; color: #212529; padding: 0.2rem 0.5rem; border-radius: 8px; font-size: 0.75rem; }
    .flag-green { background: #28a745; color: white; padding: 0.2rem 0.5rem; border-radius: 8px; font-size: 0.75rem; }
    .chat-box { height: 240px; overflow-y: auto; background: #f8f9fa; border-radius: 8px; padding: .75rem; border: 1px solid #e9ecef; }
    .map-container { min-height: 320px; border: 2px dashed #dee2e6; border-radius: 12px; }
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row observer-header">
      <div class="col-12 d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-3">
          <i class="fas fa-eye fa-2x"></i>
          <div>
            <h2 class="m-0">Democracy Watch & Observer Portal</h2>
            <small>Read-only transparency for global and local observers</small>
          </div>
        </div>
        <div>
          <span class="badge bg-light text-dark me-2" id="observer-org">Org: -</span>
          <span class="badge bg-warning text-dark" id="observer-level">Level: -</span>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-lg-3">
        <div class="observer-card">
          <h5 class="mb-3"><i class="fas fa-user-shield me-2"></i>Secure Login</h5>
          <form id="observer-login-form">
            <div class="mb-2">
              <label class="form-label">Observer ID</label>
              <input type="text" class="form-control" id="observer-id" placeholder="observer001" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Assigned County</label>
              <select id="observer-county" class="form-select" required>
                <option value="">Select county</option>
                <option>Nairobi</option>
                <option>Mombasa</option>
              </select>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="device-verified">
              <label class="form-check-label" for="device-verified">Verified device and location</label>
            </div>
            <button class="btn btn-success w-100" type="submit"><i class="fas fa-lock-open me-1"></i>Enter Portal</button>
          </form>
        </div>

        <div class="observer-card">
          <h5 class="mb-2"><i class="fas fa-gauge me-2"></i>Snapshot</h5>
          <div id="observer-snapshot">
            <div class="d-flex justify-content-between"><span>Observers active</span><strong id="metric-active">-</strong></div>
            <div class="d-flex justify-content-between"><span>Reports filed</span><strong id="metric-reports">-</strong></div>
            <div class="d-flex justify-content-between"><span>Green-rated stations</span><strong id="metric-green">-</strong></div>
            <div class="d-flex justify-content-between"><span>Red-flagged locations</span><strong id="metric-red">-</strong></div>
            <div class="d-flex justify-content-between"><span>Form mismatches</span><strong id="metric-mismatch">-</strong></div>
            <div class="d-flex justify-content-between"><span>Coverage (stations/hr)</span><strong id="metric-coverage">-</strong></div>
          </div>
        </div>

        <div class="observer-card">
          <h5 class="mb-2"><i class="fas fa-download me-2"></i>Data Export</h5>
          <button id="export-logs" class="btn btn-outline-primary w-100 mb-2"><i class="fas fa-file-csv me-1"></i>Download Logs CSV</button>
          <button id="generate-pdf" class="btn btn-outline-secondary w-100"><i class="fas fa-file-pdf me-1"></i>Generate PDF Report</button>
          <small class="text-muted d-block mt-2">All exports are sanitized and read-only.</small>
        </div>
      </div>

      <div class="col-12 col-lg-9">
        <ul class="nav nav-pills mb-3" id="observer-tabs">
          <li class="nav-item"><a class="nav-link active" data-section="map" href="#">Map</a></li>
          <li class="nav-item"><a class="nav-link" data-section="logbook" href="#">Logbook</a></li>
          <li class="nav-item"><a class="nav-link" data-section="forms" href="#">Forms</a></li>
          <li class="nav-item"><a class="nav-link" data-section="insights" href="#">Insights</a></li>
          <li class="nav-item"><a class="nav-link" data-section="comms" href="#">Comms</a></li>
        </ul>

        <div id="section-map" class="section active">
          <div class="observer-card">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-2"><i class="fas fa-map me-2"></i>Polling Stations Map</h5>
              <div class="heat-legend">
                <span style="background:#d4edda"></span> Open
                <span style="background:#fff3cd" class="ms-3"></span> Delayed
                <span style="background:#f8d7da" class="ms-3"></span> Closed
              </div>
            </div>
            <div id="observer-map" class="map-container"></div>
          </div>
        </div>

        <div id="section-logbook" class="section">
          <div class="observer-card">
            <h5 class="mb-3"><i class="fas fa-notes-medical me-2"></i>Observation Logbook</h5>
            <form id="observation-form">
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">Polling Station</label>
                  <select class="form-select" id="log-station" required></select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Category</label>
                  <select class="form-select" id="log-category">
                    <option value="general">General</option>
                    <option value="security">Security</option>
                    <option value="accessibility">Accessibility</option>
                    <option value="process">Voting Process</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Integrity Rating</label>
                  <select class="form-select" id="log-rating">
                    <option value="">-</option>
                    <option value="5">5 - Excellent</option>
                    <option value="4">4 - Good</option>
                    <option value="3">3 - Fair</option>
                    <option value="2">2 - Poor</option>
                    <option value="1">1 - Critical</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Traffic Light</label>
                  <select class="form-select" id="log-tag">
                    <option value="green">Green</option>
                    <option value="amber">Amber</option>
                    <option value="red">Red</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Confidentiality</label>
                  <select class="form-select" id="log-confidential">
                    <option value="false">Observer Only</option>
                    <option value="true">Raise Alert to IEBC HQ</option>
                  </select>
                </div>
                <div class="col-12">
                  <label class="form-label">Observer Notes</label>
                  <textarea class="form-control" id="log-notes" rows="3" placeholder="Comments on clerk behavior, device handling, queues..."></textarea>
                </div>
                <div class="col-12">
                  <label class="form-label">Attach Evidence (photo/video/audio)</label>
                  <input class="form-control" type="file" id="log-evidence" multiple>
                </div>
                <div class="col-12">
                  <button class="btn btn-success" type="submit"><i class="fas fa-upload me-1"></i>Submit Observation</button>
                </div>
              </div>
            </form>
          </div>

          <div class="observer-card">
            <h5 class="mb-2">Recent Observations</h5>
            <div id="logs-list" class="small"></div>
          </div>
        </div>

        <div id="section-forms" class="section">
          <div class="observer-card">
            <h5 class="mb-3"><i class="fas fa-file-alt me-2"></i>Results & Form Viewer (Read-Only)</h5>
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Station</label>
                <select id="forms-station" class="form-select"></select>
              </div>
              <div class="col-md-8 text-end">
                <button id="flag-mismatch" class="btn btn-outline-danger"><i class="fas fa-flag me-1"></i>Flag Mismatch</button>
              </div>
            </div>
            <div class="row mt-3 g-3">
              <div class="col-md-6">
                <div class="p-2 border rounded" id="form-photo" style="height:260px; display:flex; align-items:center; justify-content:center; background:#f8f9fa;">Scanned image preview</div>
              </div>
              <div class="col-md-6">
                <pre id="form-data" class="p-2 border rounded" style="height:260px; background:#f8f9fa; overflow:auto;">{}</pre>
              </div>
            </div>
            <div id="form-comments" class="mt-3">
              <h6>Comments</h6>
              <div class="small" id="comments-thread"></div>
            </div>
          </div>
        </div>

        <div id="section-insights" class="section">
          <div class="observer-card">
            <h5 class="mb-3"><i class="fas fa-chart-line me-2"></i>Turnout & Participation Insights</h5>
            <div id="insights-cards" class="row g-3"></div>
          </div>
        </div>

        <div id="section-comms" class="section">
          <div class="observer-card">
            <h5 class="mb-3"><i class="fas fa-comments me-2"></i>Observer Coordination & Comms Hub</h5>
            <div class="row g-3">
              <div class="col-md-8">
                <div class="chat-box" id="chat-box"></div>
                <div class="input-group mt-2">
                  <input type="text" id="chat-input" class="form-control" placeholder="Message observers in your county...">
                  <button id="chat-send" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <h6>Broadcasts from IEBC</h6>
                  <div id="broadcasts" class="small"></div>
                </div>
                <div>
                  <h6>Task Board</h6>
                  <ul id="task-board" class="small mb-0"></ul>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script src="observer-portal.js"></script>
</body>
</html>